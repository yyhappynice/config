---
title: 浏览器渲染机制
date: 2017-07-23 18:32:37
tags: 浏览器
---
![浏览器渲染](https://user-images.githubusercontent.com/12566627/28254867-7dd2e9ca-6ae3-11e7-854c-d02763eade36.png)
## 浏览器输入url
想要了解浏览器渲染流程，我们先从输入页面的url开始，首先我们看下url结构分为：
<!--more-->
> protocol(协议)：http、file、https、ftp、mailto、ws/wss

> host(主机)：是指存放资源的服务器的域名系统 (DNS) 主机名或 IP 地址

> port(端口号)：以数字形式表示，每种协议都有自己默认的端口号，例如http协议的默认端口号就是80，https的默认端口号就是443等

> path(路径)：以"/"符号隔开的字符串，一般表示的就是 Web 服务器上的一个目录或文件地址

> query(查询)：以"?"字元为起点，每个参数以"&"隔开，再以"="分开参数名称与其对应的值

> fragment(片段)：也就是在浏览器环境下location的hash值，用于指定网络资源中的片断，一般用于定位到某个位置

当浏览器发送一个URL请求后：

1、浏览器会开启一个线程来处理这个请求，同时搜索自身浏览器dns缓存，如果没有则查看本地host文件是否绑定，在没有就会在远程DNS服务器上启动[DNS查询](http://www.ruanyifeng.com/blog/2016/06/dns.html)，查找目标主机。
2、浏览器与远程Web服务器通过[TCP三次握手](https://github.com/jawil/blog/issues/14)协商来建立一个TCP/IP连接。
3、TCP/IP连接建立起来之后，浏览器就可以向服务器发起HTTP请求了。
4、服务端接收到这个请求之后，根据参数，将经过处理的数据返回给客户端。
5、web服务器提供资源服务，客户端拿到html解析后，开始下载JS、CSS、图片等资源。
6、浏览器根据拿到的资源对页面进行渲染，最终把一个完整的页面呈现给用户。

## 浏览器渲染
![流程](https://user-images.githubusercontent.com/12566627/28263946-685aa65e-6b1b-11e7-9791-3f791863fd42.png)
#### 文档对象模型 (DOM)
渲染引擎将开始解析HTML文档，并将标签转化为“内容树”的树中的DOM节点。
**分析HTML和创建DOM树**-当浏览器接收到 HTML 时，这些HTML元素被解析，并被渲染引擎变成"DOM树"，其中浏览器经过了4个步骤：
>1、转换： 浏览器从磁盘或网络读取 HTML 的原始字节，并根据文件的指定编码（例如 UTF-8）将它们转换成各个字符。

>2、令牌化： 浏览器将字符串转换成 W3C HTML5 标准规定的各种令牌，例如，“<html>”、“<body>”，以及其他尖括号内的字符串。每个令牌都具有特殊含义和一组规则。

>3、词法分析： 发出的令牌转换成定义其属性和规则的“对象”。

>4、DOM 构建： 最后，由于 HTML 标记定义不同标记之间的关系（一些标记包含在其他标记内），创建的对象链接在一个树数据结构内，此结构也会捕获原始标记中定义的父项-子项关系：HTML 对象是 body 对象的父项，body 是 paragraph 对象的父项，依此类推。

![CSSOM](https://user-images.githubusercontent.com/12566627/28296560-8a73053a-6b9b-11e7-82cd-a59ee775356b.png)

``` html
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="style.css" rel="stylesheet">
    <title>Critical Path</title>
  </head>
  <body>
    <p>Hello <span>web performance</span> students!</p>
    <div><img src="awesome-photo.jpg"></div>
  </body>
</html>
```
![render-tree](https://user-images.githubusercontent.com/12566627/28265136-cbd57e34-6b20-11e7-8d65-0b5cdeefb47c.png)
#### CSS 对象模型 (CSSOM)
``` css
body { font-size: 16px }
p { font-weight: bold }
span { color: red }
p span { display: none }
img { float: right }
```
## 参考
[1、从输入 URL 到页面加载完成的过程中都发生了什么事情？](http://fex.baidu.com/blog/2014/05/what-happen/)
[2、How Browsers Work: Behind the scenes of modern web browsers](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)
[3、浏览器统计数据](http://gs.statcounter.com/)
[4、The Critical Request](http://www.zcfy.cc/article/the-critical-request-css-tricks-3843.html?t=new)
[5、](https://sylvanassun.github.io/2017/10/03/2017-10-03-BrowserCriticalRenderingPath/)